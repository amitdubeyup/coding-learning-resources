# Node.js Interview Questions (151-200)

## Node.js File System

### 151. How do you handle file operations in Node.js?

**Answer:**
Node.js provides several ways to handle file operations:

```javascript
const fs = require('fs').promises;

// Reading files
async function readFile() {
    try {
        const data = await fs.readFile('file.txt', 'utf8');
        console.log(data);
    } catch (error) {
        console.error('Error reading file:', error);
    }
}

// Writing files
async function writeFile() {
    try {
        await fs.writeFile('file.txt', 'Hello World', 'utf8');
        console.log('File written successfully');
    } catch (error) {
        console.error('Error writing file:', error);
    }
}

// Appending to files
async function appendFile() {
    try {
        await fs.appendFile('file.txt', '\nNew content', 'utf8');
        console.log('Content appended successfully');
    } catch (error) {
        console.error('Error appending to file:', error);
    }
}
```

### 152. What is the purpose of the Node.js fs module?

**Answer:**
The fs module provides file system operations:

```javascript
const fs = require('fs');

// File operations
fs.readFile('file.txt', 'utf8', (err, data) => {
    if (err) throw err;
    console.log(data);
});

// Directory operations
fs.mkdir('new-directory', (err) => {
    if (err) throw err;
    console.log('Directory created');
});

// File stats
fs.stat('file.txt', (err, stats) => {
    if (err) throw err;
    console.log(`File size: ${stats.size}`);
    console.log(`Created: ${stats.birthtime}`);
    console.log(`Modified: ${stats.mtime}`);
});

// File watching
fs.watch('file.txt', (eventType, filename) => {
    console.log(`File ${filename} changed`);
    console.log(`Event type: ${eventType}`);
});
```

### 153. How do you implement file streaming in Node.js?

**Answer:**
File streaming for efficient file handling:

```javascript
const fs = require('fs');

// Reading large files
const readStream = fs.createReadStream('large-file.txt', {
    highWaterMark: 64 * 1024 // 64KB chunks
});

readStream.on('data', (chunk) => {
    console.log(`Received ${chunk.length} bytes of data`);
    // Process chunk
});

readStream.on('end', () => {
    console.log('Finished reading file');
});

// Writing to files
const writeStream = fs.createWriteStream('output.txt');

writeStream.write('Hello World\n');
writeStream.write('Another line\n');
writeStream.end();

// Piping streams
fs.createReadStream('input.txt')
    .pipe(fs.createWriteStream('output.txt'));
```

### 154. What is the purpose of the Node.js path module?

**Answer:**
The path module handles file paths:

```javascript
const path = require('path');

// Path manipulation
const filePath = path.join('/home', 'user', 'documents', 'file.txt');
console.log(filePath); // /home/user/documents/file.txt

// Path parsing
const parsedPath = path.parse('/home/user/file.txt');
console.log(parsedPath);
// {
//   root: '/',
//   dir: '/home/user',
//   base: 'file.txt',
//   name: 'file',
//   ext: '.txt'
// }

// Path resolution
const resolvedPath = path.resolve('src', '..', 'file.txt');
console.log(resolvedPath);

// Path normalization
const normalizedPath = path.normalize('/home//user/./documents/../file.txt');
console.log(normalizedPath); // /home/user/file.txt
```

### 155. How do you handle file permissions in Node.js?

**Answer:**
Managing file permissions:

```javascript
const fs = require('fs').promises;

async function handlePermissions() {
    try {
        // Set file permissions
        await fs.chmod('file.txt', 0o644); // rw-r--r--
        
        // Get file permissions
        const stats = await fs.stat('file.txt');
        const mode = stats.mode;
        
        // Check if file is readable
        const isReadable = (mode & fs.constants.R_OK) !== 0;
        
        // Check if file is writable
        const isWritable = (mode & fs.constants.W_OK) !== 0;
        
        // Check if file is executable
        const isExecutable = (mode & fs.constants.X_OK) !== 0;
        
        console.log({
            isReadable,
            isWritable,
            isExecutable
        });
    } catch (error) {
        console.error('Error handling permissions:', error);
    }
}
```

### 156. What is the purpose of the Node.js os module?

**Answer:**
The os module provides operating system-related utilities:

```javascript
const os = require('os');

// System information
console.log('Platform:', os.platform());
console.log('Architecture:', os.arch());
console.log('CPU Cores:', os.cpus());
console.log('Total Memory:', os.totalmem());
console.log('Free Memory:', os.freemem());
console.log('Hostname:', os.hostname());
console.log('Network Interfaces:', os.networkInterfaces());

// System uptime
console.log('Uptime:', os.uptime());

// User information
console.log('User Info:', os.userInfo());

// System constants
console.log('End of Line:', os.EOL);
```

### 157. How do you implement file compression in Node.js?

**Answer:**
File compression using the zlib module:

```javascript
const fs = require('fs');
const zlib = require('zlib');
const { pipeline } = require('stream');

// Compress file
function compressFile(input, output) {
    const gzip = zlib.createGzip();
    const source = fs.createReadStream(input);
    const destination = fs.createWriteStream(output);

    pipeline(source, gzip, destination, (err) => {
        if (err) {
            console.error('Compression failed:', err);
            return;
        }
        console.log('File compressed successfully');
    });
}

// Decompress file
function decompressFile(input, output) {
    const gunzip = zlib.createGunzip();
    const source = fs.createReadStream(input);
    const destination = fs.createWriteStream(output);

    pipeline(source, gunzip, destination, (err) => {
        if (err) {
            console.error('Decompression failed:', err);
            return;
        }
        console.log('File decompressed successfully');
    });
}

// Compress data
function compressData(data) {
    return new Promise((resolve, reject) => {
        zlib.gzip(data, (err, buffer) => {
            if (err) reject(err);
            else resolve(buffer);
        });
    });
}
```

### 158. What is the purpose of the Node.js zlib module?

**Answer:**
The zlib module provides compression functionality:

```javascript
const zlib = require('zlib');

// Gzip compression
const gzip = zlib.createGzip();
const gunzip = zlib.createGunzip();

// Compress data
const input = 'Hello World';
zlib.gzip(input, (err, buffer) => {
    if (err) throw err;
    console.log('Compressed:', buffer);
    
    // Decompress data
    zlib.gunzip(buffer, (err, output) => {
        if (err) throw err;
        console.log('Decompressed:', output.toString());
    });
});

// Stream compression
const source = fs.createReadStream('input.txt');
const destination = fs.createWriteStream('output.txt.gz');

source.pipe(gzip).pipe(destination);
```

### 159. How do you handle file system events in Node.js?

**Answer:**
Monitoring file system events:

```javascript
const fs = require('fs');
const path = require('path');

// Watch a file
fs.watch('file.txt', (eventType, filename) => {
    console.log(`File ${filename} changed`);
    console.log(`Event type: ${eventType}`);
});

// Watch a directory
fs.watch('directory', (eventType, filename) => {
    console.log(`File ${filename} in directory changed`);
    console.log(`Event type: ${eventType}`);
});

// Watch with options
const watcher = fs.watch('directory', {
    recursive: true,
    persistent: true
}, (eventType, filename) => {
    console.log(`File ${filename} changed`);
});

// Stop watching
watcher.close();
```

### 160. What is the purpose of the Node.js process module?

**Answer:**
The process module provides information about the Node.js process:

```javascript
// Process information
console.log('Process ID:', process.pid);
console.log('Node version:', process.version);
console.log('Platform:', process.platform);
console.log('Architecture:', process.arch);

// Environment variables
console.log('NODE_ENV:', process.env.NODE_ENV);

// Command line arguments
console.log('Arguments:', process.argv);

// Process events
process.on('exit', (code) => {
    console.log(`Process exiting with code: ${code}`);
});

process.on('uncaughtException', (err) => {
    console.error('Uncaught exception:', err);
    process.exit(1);
});

// Memory usage
console.log('Memory usage:', process.memoryUsage());
```

## Node.js Networking

### 161. How do you create a HTTP server in Node.js?

**Answer:**
Creating HTTP servers:

```javascript
const http = require('http');

// Basic HTTP server
const server = http.createServer((req, res) => {
    res.writeHead(200, { 'Content-Type': 'text/plain' });
    res.end('Hello World\n');
});

server.listen(3000, () => {
    console.log('Server running at http://localhost:3000/');
});

// Server with routing
const server = http.createServer((req, res) => {
    const { method, url } = req;
    
    if (method === 'GET' && url === '/api/users') {
        res.writeHead(200, { 'Content-Type': 'application/json' });
        res.end(JSON.stringify({ users: [] }));
    } else {
        res.writeHead(404);
        res.end();
    }
});
```

### 162. What is the purpose of the Node.js http module?

**Answer:**
The http module provides HTTP server and client functionality:

```javascript
const http = require('http');

// HTTP Server
const server = http.createServer((req, res) => {
    // Request handling
    console.log('Method:', req.method);
    console.log('URL:', req.url);
    console.log('Headers:', req.headers);

    // Response handling
    res.writeHead(200, {
        'Content-Type': 'application/json',
        'Access-Control-Allow-Origin': '*'
    });

    res.end(JSON.stringify({ message: 'Hello World' }));
});

// HTTP Client
const options = {
    hostname: 'api.example.com',
    port: 80,
    path: '/users',
    method: 'GET'
};

const req = http.request(options, (res) => {
    let data = '';
    res.on('data', (chunk) => {
        data += chunk;
    });
    res.on('end', () => {
        console.log(JSON.parse(data));
    });
});

req.end();
```

### 163. How do you implement WebSocket security in Node.js?

**Answer:**
Secure WebSocket implementation:

```javascript
const WebSocket = require('ws');
const https = require('https');
const fs = require('fs');

// Create HTTPS server
const server = https.createServer({
    cert: fs.readFileSync('certificate.pem'),
    key: fs.readFileSync('private-key.pem')
});

// Create WebSocket server
const wss = new WebSocket.Server({ server });

// Authentication middleware
wss.on('connection', (ws, req) => {
    // Verify client
    if (!isValidClient(req)) {
        ws.close();
        return;
    }

    // Handle messages
    ws.on('message', (message) => {
        // Validate message
        if (!isValidMessage(message)) {
            ws.send('Invalid message');
            return;
        }

        // Process message
        processMessage(message);
    });
});

// Start server
server.listen(8443);
```

### 164. What is the purpose of the Node.js net module?

**Answer:**
The net module provides TCP server and client functionality:

```javascript
const net = require('net');

// TCP Server
const server = net.createServer((socket) => {
    console.log('Client connected');

    socket.on('data', (data) => {
        console.log('Received:', data.toString());
        socket.write('Echo: ' + data);
    });

    socket.on('end', () => {
        console.log('Client disconnected');
    });
});

// TCP Client
const client = new net.Socket();

client.connect(3000, 'localhost', () => {
    console.log('Connected to server');
    client.write('Hello Server!');
});

client.on('data', (data) => {
    console.log('Received:', data.toString());
    client.destroy();
});
```

### 165. How do you handle HTTP requests in Node.js?

**Answer:**
HTTP request handling:

```javascript
const http = require('http');

const server = http.createServer((req, res) => {
    // Parse URL
    const url = new URL(req.url, `http://${req.headers.host}`);
    
    // Handle different HTTP methods
    switch (req.method) {
        case 'GET':
            handleGet(req, res, url);
            break;
        case 'POST':
            handlePost(req, res);
            break;
        case 'PUT':
            handlePut(req, res);
            break;
        case 'DELETE':
            handleDelete(req, res);
            break;
        default:
            res.writeHead(405);
            res.end();
    }
});

// Handle GET requests
function handleGet(req, res, url) {
    const path = url.pathname;
    const query = url.searchParams;
    
    res.writeHead(200, { 'Content-Type': 'application/json' });
    res.end(JSON.stringify({ path, query: Object.fromEntries(query) }));
}

// Handle POST requests
function handlePost(req, res) {
    let body = '';
    req.on('data', chunk => {
        body += chunk.toString();
    });
    req.on('end', () => {
        res.writeHead(200, { 'Content-Type': 'application/json' });
        res.end(JSON.stringify({ received: JSON.parse(body) }));
    });
}
```

### 166. What is the purpose of the Node.js dns module?

**Answer:**
The dns module provides DNS resolution functionality:

```javascript
const dns = require('dns');

// Lookup hostname
dns.lookup('example.com', (err, address, family) => {
    console.log('Address:', address);
    console.log('Family:', family);
});

// Resolve hostname
dns.resolve('example.com', 'A', (err, addresses) => {
    console.log('IP addresses:', addresses);
});

// Reverse lookup
dns.reverse('8.8.8.8', (err, hostnames) => {
    console.log('Hostnames:', hostnames);
});

// Get all records
dns.resolveAny('example.com', (err, records) => {
    console.log('DNS records:', records);
});
```

### 167. How do you implement TCP servers in Node.js?

**Answer:**
TCP server implementation:

```javascript
const net = require('net');

class TCPServer {
    constructor(port) {
        this.server = net.createServer();
        this.port = port;
        this.clients = new Map();
    }

    start() {
        this.server.on('connection', (socket) => {
            const clientId = `${socket.remoteAddress}:${socket.remotePort}`;
            this.clients.set(clientId, socket);

            console.log(`Client connected: ${clientId}`);

            socket.on('data', (data) => {
                this.handleData(socket, data);
            });

            socket.on('end', () => {
                this.clients.delete(clientId);
                console.log(`Client disconnected: ${clientId}`);
            });

            socket.on('error', (err) => {
                console.error(`Client error: ${clientId}`, err);
                this.clients.delete(clientId);
            });
        });

        this.server.listen(this.port, () => {
            console.log(`Server listening on port ${this.port}`);
        });
    }

    handleData(socket, data) {
        try {
            const message = JSON.parse(data.toString());
            // Process message
            socket.write(JSON.stringify({ status: 'received' }));
        } catch (err) {
            socket.write(JSON.stringify({ error: 'Invalid message format' }));
        }
    }
}
```

### 168. What is the purpose of the Node.js tls module?

**Answer:**
The tls module provides TLS/SSL functionality:

```javascript
const tls = require('tls');
const fs = require('fs');

// TLS Server
const options = {
    key: fs.readFileSync('private-key.pem'),
    cert: fs.readFileSync('certificate.pem'),
    ca: [fs.readFileSync('ca-certificate.pem')]
};

const server = tls.createServer(options, (socket) => {
    console.log('Client connected');
    
    socket.on('data', (data) => {
        console.log('Received:', data.toString());
        socket.write('Echo: ' + data);
    });
    
    socket.on('end', () => {
        console.log('Client disconnected');
    });
});

// TLS Client
const client = tls.connect({
    host: 'localhost',
    port: 8000,
    rejectUnauthorized: true
}, () => {
    console.log('Connected to server');
    client.write('Hello Server!');
});

client.on('data', (data) => {
    console.log('Received:', data.toString());
    client.end();
});
```

### 169. How do you handle UDP in Node.js?

**Answer:**
UDP server and client implementation:

```javascript
const dgram = require('dgram');

// UDP Server
const server = dgram.createSocket('udp4');

server.on('error', (err) => {
    console.error(`Server error:\n${err.stack}`);
    server.close();
});

server.on('message', (msg, rinfo) => {
    console.log(`Server got: ${msg} from ${rinfo.address}:${rinfo.port}`);
});

server.on('listening', () => {
    const address = server.address();
    console.log(`Server listening ${address.address}:${address.port}`);
});

server.bind(41234);

// UDP Client
const client = dgram.createSocket('udp4');
const message = Buffer.from('Hello Server!');

client.send(message, 41234, 'localhost', (err) => {
    if (err) {
        console.error('Error sending message:', err);
    }
    client.close();
});
```

### 170. What is the purpose of the Node.js url module?

**Answer:**
The url module provides URL parsing and formatting:

```javascript
const url = require('url');

// Parse URL
const parsedUrl = url.parse('https://example.com:8080/path?query=string#hash');
console.log(parsedUrl);

// Format URL
const formattedUrl = url.format({
    protocol: 'https',
    host: 'example.com',
    port: 8080,
    pathname: '/path',
    query: { query: 'string' },
    hash: 'hash'
});
console.log(formattedUrl);

// Resolve URL
const resolvedUrl = url.resolve('https://example.com/foo/bar', 'baz');
console.log(resolvedUrl); // https://example.com/foo/baz

// URL object
const myUrl = new URL('https://example.com:8080/path?query=string#hash');
console.log(myUrl.searchParams.get('query')); // string
```

## Node.js Database Integration

### 171. How do you connect to MongoDB using Node.js?

**Answer:**
MongoDB connection using Mongoose:

```javascript
const mongoose = require('mongoose');

// Connection options
const options = {
    useNewUrlParser: true,
    useUnifiedTopology: true,
    useCreateIndex: true
};

// Connect to MongoDB
mongoose.connect('mongodb://localhost:27017/mydb', options)
    .then(() => console.log('Connected to MongoDB'))
    .catch(err => console.error('Connection error:', err));

// Connection events
mongoose.connection.on('connected', () => {
    console.log('Mongoose connected');
});

mongoose.connection.on('error', (err) => {
    console.error('Mongoose connection error:', err);
});

mongoose.connection.on('disconnected', () => {
    console.log('Mongoose disconnected');
});

// Graceful shutdown
process.on('SIGINT', () => {
    mongoose.connection.close(() => {
        console.log('Mongoose connection closed');
        process.exit(0);
    });
});
```

### 172. What is the purpose of the Node.js mongodb driver?

**Answer:**
Using the MongoDB native driver:

```javascript
const { MongoClient } = require('mongodb');

async function connectToMongo() {
    const client = new MongoClient('mongodb://localhost:27017', {
        useNewUrlParser: true,
        useUnifiedTopology: true
    });

    try {
        await client.connect();
        console.log('Connected to MongoDB');

        const db = client.db('mydb');
        const collection = db.collection('users');

        // Insert document
        await collection.insertOne({
            name: 'John',
            email: 'john@example.com'
        });

        // Find documents
        const users = await collection.find({}).toArray();
        console.log('Users:', users);

    } catch (err) {
        console.error('Error:', err);
    } finally {
        await client.close();
    }
}
```

### 173. How do you implement database transactions in Node.js?

**Answer:**
MongoDB transactions implementation:

```javascript
const mongoose = require('mongoose');

async function transferMoney(fromAccount, toAccount, amount) {
    const session = await mongoose.startSession();
    session.startTransaction();

    try {
        // Update sender's balance
        await Account.updateOne(
            { _id: fromAccount },
            { $inc: { balance: -amount } },
            { session }
        );

        // Update receiver's balance
        await Account.updateOne(
            { _id: toAccount },
            { $inc: { balance: amount } },
            { session }
        );

        // Create transaction record
        await Transaction.create([{
            from: fromAccount,
            to: toAccount,
            amount: amount,
            date: new Date()
        }], { session });

        await session.commitTransaction();
        console.log('Transaction completed');
    } catch (error) {
        await session.abortTransaction();
        console.error('Transaction failed:', error);
        throw error;
    } finally {
        session.endSession();
    }
}
```

### 174. What is the purpose of the Node.js mysql module?

**Answer:**
MySQL database operations:

```javascript
const mysql = require('mysql2/promise');

async function mysqlOperations() {
    // Create connection pool
    const pool = mysql.createPool({
        host: 'localhost',
        user: 'user',
        password: 'password',
        database: 'mydb',
        waitForConnections: true,
        connectionLimit: 10,
        queueLimit: 0
    });

    try {
        // Execute query
        const [rows] = await pool.query(
            'SELECT * FROM users WHERE age > ?',
            [18]
        );
        console.log('Users:', rows);

        // Transaction
        const connection = await pool.getConnection();
        await connection.beginTransaction();

        try {
            await connection.query(
                'INSERT INTO users (name, email) VALUES (?, ?)',
                ['John', 'john@example.com']
            );
            await connection.commit();
        } catch (err) {
            await connection.rollback();
            throw err;
        } finally {
            connection.release();
        }
    } catch (err) {
        console.error('Error:', err);
    }
}
```

### 175. How do you handle database connections in Node.js?

**Answer:**
Database connection management:

```javascript
const mongoose = require('mongoose');

class DatabaseConnection {
    constructor() {
        this.connection = null;
        this.isConnected = false;
    }

    async connect() {
        if (this.isConnected) {
            return;
        }

        try {
            this.connection = await mongoose.connect('mongodb://localhost:27017/mydb', {
                useNewUrlParser: true,
                useUnifiedTopology: true
            });

            this.isConnected = true;
            console.log('Database connected');

            // Handle connection events
            mongoose.connection.on('error', this.handleError);
            mongoose.connection.on('disconnected', this.handleDisconnect);
        } catch (error) {
            console.error('Connection error:', error);
            throw error;
        }
    }

    async disconnect() {
        if (!this.isConnected) {
            return;
        }

        try {
            await mongoose.disconnect();
            this.isConnected = false;
            console.log('Database disconnected');
        } catch (error) {
            console.error('Disconnection error:', error);
            throw error;
        }
    }

    handleError(error) {
        console.error('Database error:', error);
    }

    handleDisconnect() {
        console.log('Database disconnected');
        this.isConnected = false;
    }
}
```

### 176. What is the purpose of the Node.js pg module?

**Answer:**
PostgreSQL database operations:

```javascript
const { Pool } = require('pg');

const pool = new Pool({
    user: 'user',
    host: 'localhost',
    database: 'mydb',
    password: 'password',
    port: 5432
});

async function postgresOperations() {
    const client = await pool.connect();

    try {
        // Begin transaction
        await client.query('BEGIN');

        // Insert data
        await client.query(
            'INSERT INTO users (name, email) VALUES ($1, $2)',
            ['John', 'john@example.com']
        );

        // Query data
        const result = await client.query(
            'SELECT * FROM users WHERE name = $1',
            ['John']
        );

        // Commit transaction
        await client.query('COMMIT');

        console.log('Query result:', result.rows);
    } catch (err) {
        // Rollback transaction
        await client.query('ROLLBACK');
        console.error('Error:', err);
    } finally {
        client.release();
    }
}
```

### 177. How do you implement database migrations in Node.js?

**Answer:**
Database migrations using Knex.js:

```javascript
const knex = require('knex')({
    client: 'mysql2',
    connection: {
        host: 'localhost',
        user: 'user',
        password: 'password',
        database: 'mydb'
    }
});

// Create migration
exports.up = function(knex) {
    return knex.schema
        .createTable('users', function(table) {
            table.increments('id');
            table.string('name').notNullable();
            table.string('email').unique();
            table.timestamps(true, true);
        })
        .createTable('posts', function(table) {
            table.increments('id');
            table.integer('user_id').unsigned().references('users.id');
            table.string('title');
            table.text('content');
            table.timestamps(true, true);
        });
};

// Rollback migration
exports.down = function(knex) {
    return knex.schema
        .dropTable('posts')
        .dropTable('users');
};

// Run migrations
async function runMigrations() {
    try {
        await knex.migrate.latest();
        console.log('Migrations completed');
    } catch (error) {
        console.error('Migration error:', error);
    }
}
```

### 178. What is the purpose of the Node.js redis module?

**Answer:**
Redis operations in Node.js:

```javascript
const Redis = require('ioredis');

const redis = new Redis({
    host: 'localhost',
    port: 6379,
    password: 'password'
});

async function redisOperations() {
    try {
        // String operations
        await redis.set('key', 'value');
        const value = await redis.get('key');

        // Hash operations
        await redis.hset('user:1', {
            name: 'John',
            email: 'john@example.com'
        });
        const user = await redis.hgetall('user:1');

        // List operations
        await redis.lpush('list', 'item1', 'item2');
        const items = await redis.lrange('list', 0, -1);

        // Set operations
        await redis.sadd('set', 'member1', 'member2');
        const members = await redis.smembers('set');

        // Pub/Sub
        const subscriber = new Redis();
        await subscriber.subscribe('channel');
        subscriber.on('message', (channel, message) => {
            console.log(`Received ${message} from ${channel}`);
        });

        // Publish message
        await redis.publish('channel', 'Hello World');
    } catch (error) {
        console.error('Redis error:', error);
    }
}
```

### 179. How do you implement database connection pooling in a microservices architecture?

**Answer:**
Database connection pooling for microservices:

```javascript
const mysql = require('mysql2/promise');

class DatabasePool {
    constructor(config) {
        this.pool = mysql.createPool({
            ...config,
            waitForConnections: true,
            connectionLimit: 10,
            queueLimit: 0
        });
    }

    async getConnection() {
        try {
            const connection = await this.pool.getConnection();
            return connection;
        } catch (error) {
            console.error('Error getting connection:', error);
            throw error;
        }
    }

    async query(sql, params) {
        let connection;
        try {
            connection = await this.getConnection();
            const [results] = await connection.query(sql, params);
            return results;
        } catch (error) {
            console.error('Query error:', error);
            throw error;
        } finally {
            if (connection) {
                connection.release();
            }
        }
    }

    async transaction(callback) {
        const connection = await this.getConnection();
        try {
            await connection.beginTransaction();
            const result = await callback(connection);
            await connection.commit();
            return result;
        } catch (error) {
            await connection.rollback();
            throw error;
        } finally {
            connection.release();
        }
    }
}
```

### 180. What is the purpose of the Node.js sequelize module?

**Answer:**
Sequelize ORM usage:

```javascript
const { Sequelize, DataTypes } = require('sequelize');

const sequelize = new Sequelize('database', 'user', 'password', {
    host: 'localhost',
    dialect: 'mysql'
});

// Define models
const User = sequelize.define('User', {
    name: {
        type: DataTypes.STRING,
        allowNull: false
    },
    email: {
        type: DataTypes.STRING,
        unique: true
    }
});

const Post = sequelize.define('Post', {
    title: DataTypes.STRING,
    content: DataTypes.TEXT
});

// Define relationships
User.hasMany(Post);
Post.belongsTo(User);

// Database operations
async function sequelizeOperations() {
    try {
        // Sync models
        await sequelize.sync();

        // Create user
        const user = await User.create({
            name: 'John',
            email: 'john@example.com'
        });

        // Create post
        const post = await Post.create({
            title: 'Hello World',
            content: 'This is a post'
        });

        // Associate post with user
        await user.addPost(post);

        // Query with associations
        const userWithPosts = await User.findOne({
            where: { id: user.id },
            include: [Post]
        });

        console.log('User with posts:', userWithPosts.toJSON());
    } catch (error) {
        console.error('Error:', error);
    }
}
```

## Node.js Express.js

### 181. How do you create a basic Express.js server?

**Answer:**
Basic Express.js server setup:

```javascript
const express = require('express');
const app = express();

// Middleware
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Routes
app.get('/', (req, res) => {
    res.send('Hello World!');
});

// Error handling middleware
app.use((err, req, res, next) => {
    console.error(err.stack);
    res.status(500).send('Something broke!');
});

// Start server
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
    console.log(`Server is running on port ${PORT}`);
});
```

### 182. What is the purpose of Express.js middleware?

**Answer:**
Express.js middleware examples:

```javascript
const express = require('express');
const app = express();

// Custom middleware
const logger = (req, res, next) => {
    console.log(`${req.method} ${req.url}`);
    next();
};

// Authentication middleware
const auth = (req, res, next) => {
    const token = req.headers.authorization;
    if (!token) {
        return res.status(401).json({ error: 'No token provided' });
    }
    // Verify token
    next();
};

// Error handling middleware
const errorHandler = (err, req, res, next) => {
    console.error(err.stack);
    res.status(500).json({ error: 'Something went wrong!' });
};

// Apply middleware
app.use(logger);
app.use(auth);
app.use(errorHandler);

// Routes
app.get('/api/protected', (req, res) => {
    res.json({ message: 'Protected route' });
});
```

### 183. How do you handle routing in Express.js?

**Answer:**
Express.js routing:

```javascript
const express = require('express');
const router = express.Router();

// Route parameters
router.get('/users/:id', (req, res) => {
    const userId = req.params.id;
    res.json({ userId });
});

// Query parameters
router.get('/search', (req, res) => {
    const { query, page } = req.query;
    res.json({ query, page });
});

// Route handlers
const userController = {
    getUsers: (req, res) => {
        res.json({ users: [] });
    },
    createUser: (req, res) => {
        const { name, email } = req.body;
        res.status(201).json({ name, email });
    }
};

// Route grouping
router.route('/users')
    .get(userController.getUsers)
    .post(userController.createUser);

// Nested routes
const postRouter = express.Router();
postRouter.get('/', (req, res) => {
    res.json({ posts: [] });
});

router.use('/users/:userId/posts', postRouter);
```

### 184. What is the purpose of Express.js error handling?

**Answer:**
Express.js error handling:

```javascript
const express = require('express');
const app = express();

// Async error handler
const asyncHandler = (fn) => (req, res, next) => {
    Promise.resolve(fn(req, res, next)).catch(next);
};

// Custom error class
class AppError extends Error {
    constructor(message, statusCode) {
        super(message);
        this.statusCode = statusCode;
    }
}

// Error handling middleware
app.use((err, req, res, next) => {
    err.statusCode = err.statusCode || 500;
    err.status = err.status || 'error';

    if (process.env.NODE_ENV === 'development') {
        res.status(err.statusCode).json({
            status: err.status,
            error: err,
            message: err.message,
            stack: err.stack
        });
    } else {
        res.status(err.statusCode).json({
            status: err.status,
            message: err.message
        });
    }
});

// Usage in routes
app.get('/users/:id', asyncHandler(async (req, res) => {
    const user = await User.findById(req.params.id);
    if (!user) {
        throw new AppError('User not found', 404);
    }
    res.json(user);
}));
```

### 185. How do you implement authentication in Express.js?

**Answer:**
Express.js authentication:

```javascript
const express = require('express');
const jwt = require('jsonwebtoken');
const bcrypt = require('bcrypt');
const app = express();

// Authentication middleware
const authenticateToken = (req, res, next) => {
    const authHeader = req.headers['authorization'];
    const token = authHeader && authHeader.split(' ')[1];

    if (!token) {
        return res.status(401).json({ error: 'Access denied' });
    }

    jwt.verify(token, process.env.JWT_SECRET, (err, user) => {
        if (err) {
            return res.status(403).json({ error: 'Invalid token' });
        }
        req.user = user;
        next();
    });
};

// Login route
app.post('/login', async (req, res) => {
    const { email, password } = req.body;
    
    // Find user
    const user = await User.findOne({ email });
    if (!user) {
        return res.status(400).json({ error: 'User not found' });
    }

    // Verify password
    const validPassword = await bcrypt.compare(password, user.password);
    if (!validPassword) {
        return res.status(400).json({ error: 'Invalid password' });
    }

    // Generate token
    const token = jwt.sign(
        { id: user._id },
        process.env.JWT_SECRET,
        { expiresIn: '1h' }
    );

    res.json({ token });
});

// Protected route
app.get('/profile', authenticateToken, (req, res) => {
    res.json({ user: req.user });
});
```

### 186. What is the purpose of Express.js static files?

**Answer:**
Serving static files in Express.js:

```javascript
const express = require('express');
const path = require('path');
const app = express();

// Serve static files
app.use(express.static('public'));

// Serve specific directory
app.use('/images', express.static('images'));

// Serve with options
app.use('/static', express.static('public', {
    maxAge: '1d',
    etag: true,
    lastModified: true,
    setHeaders: (res, path) => {
        if (path.endsWith('.css')) {
            res.setHeader('Content-Type', 'text/css');
        }
    }
}));

// Serve index.html for specific routes
app.get('/', (req, res) => {
    res.sendFile(path.join(__dirname, 'public', 'index.html'));
});
```

### 187. How do you implement secure file uploads in Express.js?

**Answer:**
Secure file uploads using multer:

```javascript
const express = require('express');
const multer = require('multer');
const path = require('path');
const app = express();

// Configure storage
const storage = multer.diskStorage({
    destination: (req, file, cb) => {
        cb(null, 'uploads/');
    },
    filename: (req, file, cb) => {
        const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);
        cb(null, file.fieldname + '-' + uniqueSuffix + path.extname(file.originalname));
    }
});

// File filter
const fileFilter = (req, file, cb) => {
    const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];
    if (allowedTypes.includes(file.mimetype)) {
        cb(null, true);
    } else {
        cb(new Error('Invalid file type'), false);
    }
};

// Configure upload
const upload = multer({
    storage: storage,
    fileFilter: fileFilter,
    limits: {
        fileSize: 5 * 1024 * 1024 // 5MB
    }
});

// Upload route
app.post('/upload', upload.single('file'), (req, res) => {
    if (!req.file) {
        return res.status(400).json({ error: 'No file uploaded' });
    }
    res.json({
        filename: req.file.filename,
        size: req.file.size
    });
});
```

### 188. What is the purpose of Express.js template engines?

**Answer:**
Using template engines in Express.js:

```javascript
const express = require('express');
const app = express();

// Set template engine
app.set('view engine', 'ejs');
app.set('views', './views');

// Render template
app.get('/', (req, res) => {
    res.render('index', {
        title: 'Home',
        users: [
            { name: 'John', age: 30 },
            { name: 'Jane', age: 25 }
        ]
    });
});

// Template (views/index.ejs)
/*
<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>
</head>
<body>
    <h1><%= title %></h1>
    <ul>
        <% users.forEach(user => { %>
            <li><%= user.name %> - <%= user.age %></li>
        <% }); %>
    </ul>
</body>
</html>
*/
```

### 189. How do you implement CORS in Express.js?

**Answer:**
CORS implementation in Express.js:

```javascript
const express = require('express');
const cors = require('cors');
const app = express();

// Basic CORS
app.use(cors());

// CORS with options
app.use(cors({
    origin: 'http://localhost:3000',
    methods: ['GET', 'POST', 'PUT', 'DELETE'],
    allowedHeaders: ['Content-Type', 'Authorization'],
    credentials: true,
    maxAge: 86400 // 24 hours
}));

// Dynamic CORS
const corsOptions = {
    origin: (origin, callback) => {
        const allowedOrigins = ['http://localhost:3000', 'https://example.com'];
        if (!origin || allowedOrigins.includes(origin)) {
            callback(null, true);
        } else {
            callback(new Error('Not allowed by CORS'));
        }
    }
};

app.use(cors(corsOptions));
```

### 190. What is the purpose of Express.js security middleware?

**Answer:**
Security middleware in Express.js:

```javascript
const express = require('express');
const helmet = require('helmet');
const rateLimit = require('express-rate-limit');
const xss = require('xss-clean');
const hpp = require('hpp');
const app = express();

// Security headers
app.use(helmet());

// Rate limiting
const limiter = rateLimit({
    windowMs: 15 * 60 * 1000, // 15 minutes
    max: 100 // limit each IP to 100 requests per windowMs
});
app.use('/api/', limiter);

// XSS protection
app.use(xss());

// HTTP Parameter Pollution
app.use(hpp());

// Content Security Policy
app.use(helmet.contentSecurityPolicy({
    directives: {
        defaultSrc: ["'self'"],
        scriptSrc: ["'self'", "'unsafe-inline'"],
        styleSrc: ["'self'", "'unsafe-inline'"],
        imgSrc: ["'self'", 'data:', 'https:'],
        connectSrc: ["'self'", 'https://api.example.com']
    }
}));

// Prevent clickjacking
app.use(helmet.frameguard({ action: 'deny' }));

// Disable X-Powered-By header
app.disable('x-powered-by');
```

## Node.js Real-time Applications

### 191. How do you implement real-time features using Socket.IO?

**Answer:**
Socket.IO implementation:

```javascript
const express = require('express');
const app = express();
const http = require('http').createServer(app);
const io = require('socket.io')(http);

// Socket.IO connection handling
io.on('connection', (socket) => {
    console.log('User connected:', socket.id);

    // Join room
    socket.on('join', (room) => {
        socket.join(room);
        io.to(room).emit('userJoined', socket.id);
    });

    // Handle messages
    socket.on('message', (data) => {
        io.to(data.room).emit('message', {
            user: socket.id,
            text: data.text,
            time: new Date()
        });
    });

    // Handle typing
    socket.on('typing', (data) => {
        socket.to(data.room).emit('userTyping', socket.id);
    });

    // Handle disconnection
    socket.on('disconnect', () => {
        console.log('User disconnected:', socket.id);
    });
});

// Start server
const PORT = process.env.PORT || 3000;
http.listen(PORT, () => {
    console.log(`Server running on port ${PORT}`);
});
```

### 192. What is the purpose of the Node.js ws module?

**Answer:**
WebSocket implementation using ws module:

```javascript
const WebSocket = require('ws');
const wss = new WebSocket.Server({ port: 8080 });

wss.on('connection', (ws) => {
    console.log('Client connected');

    // Send welcome message
    ws.send('Welcome to WebSocket server');

    // Handle messages
    ws.on('message', (message) => {
        console.log('Received:', message.toString());

        // Broadcast to all clients
        wss.clients.forEach((client) => {
            if (client !== ws && client.readyState === WebSocket.OPEN) {
                client.send(message.toString());
            }
        });
    });

    // Handle errors
    ws.on('error', (error) => {
        console.error('WebSocket error:', error);
    });

    // Handle close
    ws.on('close', () => {
        console.log('Client disconnected');
    });
});
```

### 193. How do you implement WebSocket authentication in Node.js?

**Answer:**
WebSocket authentication:

```javascript
const WebSocket = require('ws');
const jwt = require('jsonwebtoken');

const wss = new WebSocket.Server({ 
    port: 8080,
    verifyClient: async (info, callback) => {
        try {
            const token = info.req.headers['sec-websocket-protocol'];
            if (!token) {
                callback(false, 401, 'Unauthorized');
                return;
            }

            const decoded = jwt.verify(token, process.env.JWT_SECRET);
            info.req.user = decoded;
            callback(true);
        } catch (error) {
            callback(false, 401, 'Unauthorized');
        }
    }
});

wss.on('connection', (ws, req) => {
    const user = req.user;
    console.log('Authenticated user connected:', user.id);

    // Handle messages
    ws.on('message', (message) => {
        const data = JSON.parse(message);
        
        // Verify user permissions
        if (!hasPermission(user, data.action)) {
            ws.send(JSON.stringify({
                error: 'Permission denied'
            }));
            return;
        }

        // Process message
        processMessage(user, data);
    });
});
```

### 194. What is the purpose of the Node.js events module?

**Answer:**
Event handling in Node.js:

```javascript
const EventEmitter = require('events');

class ChatRoom extends EventEmitter {
    constructor() {
        super();
        this.users = new Map();
    }

    join(user) {
        this.users.set(user.id, user);
        this.emit('userJoined', user);
    }

    leave(userId) {
        const user = this.users.get(userId);
        if (user) {
            this.users.delete(userId);
            this.emit('userLeft', user);
        }
    }

    message(userId, text) {
        const user = this.users.get(userId);
        if (user) {
            this.emit('newMessage', {
                user,
                text,
                time: new Date()
            });
        }
    }
}

// Usage
const chatRoom = new ChatRoom();

chatRoom.on('userJoined', (user) => {
    console.log(`${user.name} joined the chat`);
});

chatRoom.on('userLeft', (user) => {
    console.log(`${user.name} left the chat`);
});

chatRoom.on('newMessage', (message) => {
    console.log(`${message.user.name}: ${message.text}`);
});
```

### 195. How do you implement real-time notifications in Node.js?

**Answer:**
Real-time notification system:

```javascript
const express = require('express');
const app = express();
const server = require('http').createServer(app);
const io = require('socket.io')(server);

class NotificationService {
    constructor() {
        this.userSockets = new Map();
    }

    // Register user socket
    registerUser(userId, socket) {
        this.userSockets.set(userId, socket);
    }

    // Remove user socket
    removeUser(userId) {
        this.userSockets.delete(userId);
    }

    // Send notification to user
    sendNotification(userId, notification) {
        const socket = this.userSockets.get(userId);
        if (socket) {
            socket.emit('notification', notification);
        }
    }

    // Broadcast notification to all users
    broadcastNotification(notification) {
        io.emit('notification', notification);
    }
}

const notificationService = new NotificationService();

// Socket.IO connection
io.on('connection', (socket) => {
    const userId = socket.handshake.query.userId;
    notificationService.registerUser(userId, socket);

    socket.on('disconnect', () => {
        notificationService.removeUser(userId);
    });
});

// API endpoint to send notification
app.post('/notifications', (req, res) => {
    const { userId, message } = req.body;
    notificationService.sendNotification(userId, {
        message,
        time: new Date()
    });
    res.json({ success: true });
});
```

### 196. What is the purpose of the Node.js stream module?

**Answer:**
Stream operations in Node.js:

```javascript
const { Readable, Writable, Transform, pipeline } = require('stream');

// Custom readable stream
class NumberGenerator extends Readable {
    constructor(options) {
        super(options);
        this.current = 0;
        this.max = options.max || 100;
    }

    _read() {
        if (this.current < this.max) {
            this.push(String(this.current++));
        } else {
            this.push(null);
        }
    }
}

// Custom writable stream
class NumberLogger extends Writable {
    _write(chunk, encoding, callback) {
        console.log('Received:', chunk.toString());
        callback();
    }
}

// Custom transform stream
class NumberMultiplier extends Transform {
    _transform(chunk, encoding, callback) {
        const number = parseInt(chunk.toString());
        this.push(String(number * 2));
        callback();
    }
}

// Using streams
const generator = new NumberGenerator({ max: 5 });
const multiplier = new NumberMultiplier();
const logger = new NumberLogger();

pipeline(
    generator,
    multiplier,
    logger,
    (err) => {
        if (err) {
            console.error('Pipeline failed:', err);
        } else {
            console.log('Pipeline succeeded');
        }
    }
);
```

### 197. How do you handle real-time data in Node.js?

**Answer:**
Real-time data handling:

```javascript
const express = require('express');
const app = express();
const server = require('http').createServer(app);
const io = require('socket.io')(server);

class RealTimeDataHandler {
    constructor() {
        this.data = new Map();
        this.subscribers = new Map();
    }

    // Update data
    updateData(key, value) {
        this.data.set(key, value);
        this.notifySubscribers(key);
    }

    // Subscribe to data changes
    subscribe(key, socket) {
        if (!this.subscribers.has(key)) {
            this.subscribers.set(key, new Set());
        }
        this.subscribers.get(key).add(socket);
    }

    // Unsubscribe from data changes
    unsubscribe(key, socket) {
        const subscribers = this.subscribers.get(key);
        if (subscribers) {
            subscribers.delete(socket);
        }
    }

    // Notify subscribers of data changes
    notifySubscribers(key) {
        const value = this.data.get(key);
        const subscribers = this.subscribers.get(key);
        if (subscribers) {
            subscribers.forEach(socket => {
                socket.emit('dataUpdate', { key, value });
            });
        }
    }
}

const dataHandler = new RealTimeDataHandler();

// Socket.IO connection
io.on('connection', (socket) => {
    // Subscribe to data updates
    socket.on('subscribe', (key) => {
        dataHandler.subscribe(key, socket);
    });

    // Unsubscribe from data updates
    socket.on('unsubscribe', (key) => {
        dataHandler.unsubscribe(key, socket);
    });

    // Handle disconnection
    socket.on('disconnect', () => {
        // Clean up subscriptions
        dataHandler.subscribers.forEach((subscribers, key) => {
            subscribers.delete(socket);
        });
    });
});
```

### 198. What is the purpose of the Node.js cluster module?

**Answer:**
Cluster implementation:

```javascript
const cluster = require('cluster');
const os = require('os');
const express = require('express');

if (cluster.isMaster) {
    const numCPUs = os.cpus().length;
    console.log(`Master ${process.pid} is running`);

    // Fork workers
    for (let i = 0; i < numCPUs; i++) {
        cluster.fork();
    }

    // Handle worker events
    cluster.on('exit', (worker, code, signal) => {
        console.log(`Worker ${worker.process.pid} died`);
        // Replace the dead worker
        cluster.fork();
    });

    // Handle worker messages
    cluster.on('message', (worker, message) => {
        console.log(`Received message from worker ${worker.process.pid}:`, message);
    });
} else {
    // Worker process
    const app = express();
    
    app.get('/', (req, res) => {
        res.send(`Worker ${process.pid} handled request`);
    });

    app.listen(3000, () => {
        console.log(`Worker ${process.pid} started`);
    });

    // Send message to master
    process.send({ type: 'workerStarted', pid: process.pid });
}
```

### 199. How do you implement real-time chat in Node.js?

**Answer:**
Real-time chat implementation:

```javascript
const express = require('express');
const app = express();
const server = require('http').createServer(app);
const io = require('socket.io')(server);

class ChatServer {
    constructor() {
        this.rooms = new Map();
        this.users = new Map();
    }

    // Handle user connection
    handleConnection(socket) {
        console.log('User connected:', socket.id);

        // Join room
        socket.on('join', (room) => {
            this.joinRoom(socket, room);
        });

        // Handle messages
        socket.on('message', (data) => {
            this.handleMessage(socket, data);
        });

        // Handle typing
        socket.on('typing', (data) => {
            this.handleTyping(socket, data);
        });

        // Handle disconnection
        socket.on('disconnect', () => {
            this.handleDisconnect(socket);
        });
    }

    // Join room
    joinRoom(socket, room) {
        socket.join(room);
        if (!this.rooms.has(room)) {
            this.rooms.set(room, new Set());
        }
        this.rooms.get(room).add(socket.id);
        io.to(room).emit('userJoined', {
            userId: socket.id,
            room: room
        });
    }

    // Handle message
    handleMessage(socket, data) {
        io.to(data.room).emit('message', {
            userId: socket.id,
            text: data.text,
            time: new Date()
        });
    }

    // Handle typing
    handleTyping(socket, data) {
        socket.to(data.room).emit('userTyping', {
            userId: socket.id,
            room: data.room
        });
    }

    // Handle disconnection
    handleDisconnect(socket) {
        this.rooms.forEach((users, room) => {
            if (users.has(socket.id)) {
                users.delete(socket.id);
                io.to(room).emit('userLeft', {
                    userId: socket.id,
                    room: room
                });
            }
        });
    }
}

const chatServer = new ChatServer();

// Socket.IO connection
io.on('connection', (socket) => {
    chatServer.handleConnection(socket);
});

// Start server
const PORT = process.env.PORT || 3000;
server.listen(PORT, () => {
    console.log(`Server running on port ${PORT}`);
});
```

### 200. What is the purpose of the Node.js child_process module?

**Answer:**
Child process handling:

```javascript
const { spawn, exec, fork } = require('child_process');

// Spawn a new process
function runCommand(command, args) {
    const child = spawn(command, args);

    child.stdout.on('data', (data) => {
        console.log(`stdout: ${data}`);
    });

    child.stderr.on('data', (data) => {
        console.error(`stderr: ${data}`);
    });

    child.on('close', (code) => {
        console.log(`Child process exited with code ${code}`);
    });
}

// Execute a command
function executeCommand(command) {
    exec(command, (error, stdout, stderr) => {
        if (error) {
            console.error(`Error: ${error}`);
            return;
        }
        if (stderr) {
            console.error(`stderr: ${stderr}`);
            return;
        }
        console.log(`stdout: ${stdout}`);
    });
}

// Fork a new Node.js process
function forkProcess(modulePath) {
    const child = fork(modulePath);

    child.on('message', (message) => {
        console.log('Received from child:', message);
    });

    child.send({ type: 'start', data: 'Hello from parent' });

    child.on('exit', (code) => {
        console.log(`Child process exited with code ${code}`);
    });
}

// Usage examples
runCommand('ls', ['-l']);
executeCommand('echo "Hello World"');
forkProcess('./worker.js');
```
